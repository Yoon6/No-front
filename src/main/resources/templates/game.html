<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Game</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd"></script>
</head>
<body>
    <h2 align="center">Auto Video Stream to Still Image</h2>
    <video
            id="myVideo"
            width="400"
            height="300"
            style="border: 1px solid #ddd"
    ></video>
    <canvas
            id="myCanvas"
            width="160"
            height="140"
            style="border: 1px solid #ddd"
    ></canvas
    ><br />

    <input type="button" value="get Video" onclick="{getVideo()}" />
    <input type="button" value="get Pic" onclick="{takeSnapshot()}" /><br />

    <img
            hidden="true"
            id="img"
            class="abc"
            name="abc"
            src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOEAAADhCAMAAAAJbSJIAAAAe1BMVEX///8AAADj4+OxsbHU1NTs7OwTExNSUlK4uLhgYGDp6ekEBATz8/POzs5lZWX5+fktLS1sbGympqZzc3NFRUVAQEDa2trGxsY3NzeBgYFUVFSHh4dpaWmdnZ2rq6tycnIxMTGPj48RERG+vr4bGxskJCSYmJhERESEhIS3ls2+AAADzElEQVR4nO3b63aiMBiFYS1axYInPGtVrNP2/q9wSAKeIKGOFf3WvM+vCKYru6QkhLRWAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgEYK2S/Do5t2u81Z3ees8uoE3+3YGrNe/H93AawTNzLHv9folCfu9B7b4SqvTdmcZQ9MXi+lz4UMbfY2Ps0sTp0fnKt+kU2yiMs4f2uprDM8SDtKjqty11umq09U07xcUJpyq8oe1jr7u04oaeDOVcD8Nw7AxOyaMkuLOPuYFu+R8VFEDb7ZOGvtHl0ZJaWMOujuplG7aifxEd6zuKbq0VzfTriq23J30vJsGc/9S9BzzgdeSEc9ZWX1hZYrjgrr7CtpfqlMScOOsvUm+MTPFwtrPcBFfShI2nLXD4+9gVlT7pYIEZXTC0aJVzC8bCz78z7QUzM9qLkZPlXByhx88eaqE7q6YmniR3xot/Ln3o19IQ1jCZnz6lNGPyx99ZSVsRrl7SNQsqSMq4brwLuu5K0lKODh0zs0yXg4O3dU9VMpJ2EsnK7N19rcXrNOxb+R6wJeTcGvynQ+M0/Soo56YhL6OEueOL/Xxlb2ilIRD603F02eG1ppCEppZa/vw2YviYdbqtj5nnVsLSbg676Lmin6lj4yx+jCw1BSS0EzLj5+zcWNgbqJfrhAyEqrFxNMV0c9sKBzrj3o1dWmpKyOhOtc6PRCPzDBR9/VHvcxhqSsiob5Gl+s0L/Pj3ad9cY1PiUj4WXyJvONgr0rvxZVFJPQt05bvQ53ZocPmiEg4ttxImqqOXr1QWb+KK4tIuLX1QXWH0Wvd7/bJqYSEvT+2aZla616ogkpoeYUoImHfdg3fs5mOKmyLf7CEhPrvMP9UocStub5yy8PonyMi4eJywM8ZZd01T0TCpWPKYtStV1lGwqljynL8gmVZXETCnn6OcFTWD1eWxRoRCc0bUHsrdV3bG1QZCUNXhHQNx9aLZSTU90rr0q+Xe7g6JSShbqbl1ZQ55676/AnNU35hQ/XbM8eGISkJ01e77dxxs9LmWBIWk1A/KSVjxvmrpk66C87xAkpMwtok3WE6P36pYfpu/c0VQE7CWid72bQfDL22N1xl+1P6zp0WghKazV95Jdu9RCWsTfPbgcZluzRkJUwyLs7yLcp3JEpLWKsFXrRVf4Gv28j7yRZ9eQm1oPnj/z8QmvAKJKzMf5Jw2vx906dKuHv9fbunSng3z5CwedeEZZvfKjEob+c/c+8Lq0zo3Yuc/4kCAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEjzF0PmKp4KtBO5AAAAAElFTkSuQmCC"
            crossorigin="anonymous"
    />
    <div id="result"></div>


<script>
var myVideoStream = document.getElementById('myVideo')     // make it a global variable
var myStoredInterval = 0

function getVideo(){
navigator.getMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia;
navigator.getMedia({video: true, audio: false},

  function(stream) {
    myVideoStream.srcObject = stream
    myVideoStream.play();
},

 function(error) {
   alert('webcam not working');
});
}

function takeSnapshot() {
 var myCanvasElement = document.getElementById('myCanvas');
 var myCTX = myCanvasElement.getContext('2d');
 myCTX.drawImage(myVideoStream, 0, 0, myCanvasElement.width, myCanvasElement.height);
 console.log(myCanvasElement.toDataURL());

  var image = document.getElementsByClassName("abc");
  image.src = myCanvasElement.toDataURL();
  document.abc.src = myCanvasElement.toDataURL();

  const img = document.getElementById("img");
         cocoSsd.load().then((model) => {
           model.detect(img).then((predictions) => {
             console.log("Redictions: ", predictions);
             predictions.forEach((item) => {
               console.log("class", item.class);
               document.getElementById("result").innerHTML = item.class;
             });
           });
         });

}




</script>
</body>
</html>

